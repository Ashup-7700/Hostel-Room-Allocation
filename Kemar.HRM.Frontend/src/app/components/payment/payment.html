<div class="page">

  <div class="header">
    <h2>Payments</h2>

    <div class="header-actions">
      <!-- ‚úÖ Status Filter -->
      <select class="filter"
              [(ngModel)]="filterStatus"
              (change)="applyFilter()">
        <option value="all">All</option>
        <option value="pending">Pending</option>
        <option value="completed">Completed</option>
      </select>

      <!-- ‚úÖ Global Search -->
      <input type="text"
             class="search"
             placeholder="Search payments..."
             [(ngModel)]="searchText"
             (input)="applyFilter()">

      <button class="add-btn" data-tooltip="Add Payment" (click)="openAdd()">+</button>
    </div>
  </div>

  <!-- Payments Table -->
  <table>
    <thead>
      <tr>
        <th>Student Name</th>
        <th>Paid Amount</th>
        <th>Total Amount</th>
        <th>Remaining Amount</th>
        <th>Payment Mode</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of filteredList">
        <td>{{ getStudentName(p.studentId) }}</td>
        <td>{{ p.paidAmount }}</td>
        <td>{{ p.totalAmount }}</td>
        <td>{{ getRemainingAmount(p) }}</td>
        <td>{{ p.paymentMode }}</td>
        <td>
          <span [class.completed]="getPaymentStatus(p) === 'Completed'"
                [class.pending]="getPaymentStatus(p) === 'Pending'">
            {{ getPaymentStatus(p) }}
          </span>
        </td>
        <td>
          <button class="icon-btn edit" data-tooltip="Edit" (click)="openEdit(p)">‚úèÔ∏è</button>
          <button class="icon-btn view" data-tooltip="View Details" (click)="viewDetails(p)">üëÅ</button>
        </td>
      </tr>

      <!-- Empty State -->
      <tr *ngIf="filteredList.length === 0">
        <td colspan="7" class="no-data">No payments found</td>
      </tr>
    </tbody>
  </table>

  <!-- MODAL -->
  <div class="modal" *ngIf="showModal">
    <div class="modal-box">
      <h3>{{ form.value.paymentId ? 'Update Payment' : 'Add Payment' }}</h3>

      <form [formGroup]="form" (ngSubmit)="save()">

        <!-- Student Selection -->
      <!-- Student Selection -->
<label>Student <span>*</span></label>
<select formControlName="studentId" #studentSelect (change)="onStudentChange(studentSelect.value)">
  <option value="">-- Select Student --</option>
  <option *ngFor="let s of students" [value]="s.studentId">{{ s.name }}</option>
</select>


        <!-- Paid Amount -->
        <label>Paid Amount <span>*</span></label>
        <input type="number" formControlName="paidAmount">

        <!-- Total Amount (read-only) -->
        <label>Total Amount <span>*</span></label>
<input type="number" formControlName="totalAmount" required>

        <!-- Remaining Amount (read-only) -->
        <label>Remaining Amount</label>
        <input type="number" [value]="form.value.totalAmount - form.value.paidAmount" readonly>

        <!-- Payment Mode -->
        <label>Payment Mode <span>*</span></label>
        <select formControlName="paymentMode">
          <option value="">-- Select Mode --</option>
          <option value="Cash">Cash</option>
          <option value="UPI">UPI</option>
          <option value="Card">Card</option>
          <option value="NetBanking">Net Banking</option>
        </select>

        <!-- Modal Actions -->
        <div class="actions">
          <button type="submit" class="save">Save</button>
          <button type="button" class="reset" (click)="reset()">Reset</button>
          <button type="button" class="close" (click)="close()">Close</button>
        </div>

      </form>
    </div>
  </div>

</div>
